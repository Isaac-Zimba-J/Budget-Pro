<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:BudgetPro.ViewModels"
             x:Class="BudgetPro.Pages.EditBudgetPage"
             x:DataType="viewModels:EditBudgetViewModel"
             Title="Edit Budget"
             BackgroundColor="#F5F5F5">
    <ScrollView Padding="10">
        <VerticalStackLayout Spacing="5">
            <!-- Budget Inputs -->
            <VerticalStackLayout Spacing="10"
                                 Padding="10,0,10,20">
                <Entry Text="{Binding BudgetName}"
                       Placeholder="Budget Name"
                       BackgroundColor="White"
                       TextColor="Black"
                       HeightRequest="50"
                        />
                <Entry Text="{Binding BudgetAmount}"
                       Placeholder="Amount"
                       Keyboard="Numeric"
                       BackgroundColor="White"
                       TextColor="Black"
                       HeightRequest="50"
                        />
            </VerticalStackLayout>
            <!-- Items Header and Add Button -->
            <Grid ColumnDefinitions="*,Auto"
                  Padding="0">
                <Label Text="Items"
                       VerticalOptions="Center"
                       FontAttributes="Bold"
                       FontSize="16"
                       Grid.Column="0" />
                <Button Text="Add Item"
                        Command="{Binding AddItemCommand}"
                        WidthRequest="90"
                        Grid.Column="1"
                        BackgroundColor="#210F37"
                        TextColor="White"
                        FontSize="14"
                        CornerRadius="8" />
            </Grid>
            <!-- Item List -->
            <CollectionView ItemsSource="{Binding BudgetItems}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 8"
                                BackgroundColor="#FFFFFF"
                                Padding="10"
                                Margin="0,5">
                            <Grid ColumnDefinitions="*,Auto,Auto"
                                  RowDefinitions="Auto,Auto">
                                <!-- Item Name -->
                                <Label Text="{Binding Name}"
                                       Grid.Column="0"
                                       Grid.Row="0"
                                       FontAttributes="Bold"
                                       FontSize="16"
                                       VerticalOptions="Center"
                                       HorizontalOptions="StartAndExpand" />
                                <!-- Item Price -->
                                <Label Text="{Binding PriceFormatted}"
                                       Grid.Row="1"
                                       Grid.Column="0"
                                       FontSize="14"
                                       TextColor="Gray" />
                                <!-- Quantity Stepper -->
                                <HorizontalStackLayout Grid.Column="1"
                                                       VerticalOptions="Center"
                                                       Spacing="5"
                                                       Grid.RowSpan="2">
                                    <Button Text="âˆ’"
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            FontSize="20"
                                            Command="{Binding BindingContext.DecreaseQuantityCommand, Source={x:Reference Name=EditBudgetPage}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#F5F5F5"
                                            CornerRadius="15"
                                            TextColor="Black" />
                                    <Label Text="{Binding Quantity}"
                                           FontAttributes="Bold"
                                           FontSize="22"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center" />
                                    <Button Text="+"
                                            WidthRequest="30"
                                            HeightRequest="30"
                                            FontSize="20"
                                            Command="{Binding BindingContext.IncreaseQuantityCommand, Source={x:Reference Name=EditBudgetPage}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#F5F5F5"
                                            CornerRadius="15"
                                            TextColor="Black" />
                                </HorizontalStackLayout>
                                <!-- Delete Icon -->
                                <Button ImageSource="bin.png"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        CornerRadius="20"
                                        VerticalOptions="End"
                                        BackgroundColor="Transparent"
                                        Command="{Binding BindingContext.DeleteItemCommand, Source={x:Reference Name=EditBudgetPage}}"
                                        CommandParameter="{Binding .}"
                                        Grid.Column="2"
                                        Grid.RowSpan="2" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <!-- Save and Delete -->
            <Button Text="Save"
                    Command="{Binding UpdateBudgetCommand}"
                    Padding="10"
                    Margin="0,50,0,10"
                    BackgroundColor="#210F37"
                    TextColor="White"
                    CornerRadius="8" />
            <Button Text="Delete"
                    Command="{Binding DeleteBudgetCommand}"
                    Padding="10"
                    TextColor="#210F37"
                    BorderColor="#210F37"
                    BorderWidth="2"
                    BackgroundColor="Transparent"
                    CornerRadius="8" />
            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="#210F37"
                               HeightRequest="40" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>